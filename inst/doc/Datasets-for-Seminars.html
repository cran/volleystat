<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Viktor Bozhinov" />

<meta name="date" content="2019-05-20" />

<title>Datasets for Seminars</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Datasets for Seminars</h1>
<h4 class="author"><em>Viktor Bozhinov</em></h4>
<h4 class="date"><em>2019-05-20</em></h4>



<p>This vignette demonstrates how the volleystat package can be used to generate two datasets for the analysis of team diveristy and team performance and the demand for volleyball. Both datasets are used in a seminar on empirical sports economics in a bachelor degree programm. First, we generate a dataset which contains all matches with information on both teams, i.e., we split the matches dataset into a home and away dataset and join the corresponding away and home team information. In sum, we have then a dataset with information on each match from the home and away team perspective.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">    <span class="co"># Select away team matches</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">    df_<span class="dv">1</span> &lt;-<span class="st"> </span>matches <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">            </span><span class="kw">rename</span>(<span class="dt">team_id_2  =</span> team_id,</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">                   <span class="dt">team_name_2 =</span> team_name,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">                   <span class="dt">set_won_team_2   =</span> set_won) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">            </span><span class="kw">filter</span>(match <span class="op">==</span><span class="st"> &quot;away&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">            </span><span class="kw">select</span>(<span class="op">-</span>match)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10">    <span class="co"># Select home team matches and join away team information</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11">    df_home &lt;-<span class="st"> </span>matches <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="st">               </span><span class="kw">rename</span>(<span class="dt">team_id_1   =</span> team_id,</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">                      <span class="dt">team_name_1 =</span> team_name,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">                      <span class="dt">set_won_team_1   =</span> set_won) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">               </span><span class="kw">filter</span>(match <span class="op">==</span><span class="st"> &quot;home&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">               </span><span class="kw">select</span>(<span class="op">-</span>match) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(df_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">match =</span> <span class="st">&quot;home&quot;</span>)</a>
<a class="sourceLine" id="cb1-17" data-line-number="17"></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">    <span class="co"># Select home team matches</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19">    df_<span class="dv">1</span> &lt;-<span class="st"> </span>matches <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="st">            </span><span class="kw">rename</span>(<span class="dt">team_id_2  =</span> team_id,</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">                   <span class="dt">team_name_2 =</span> team_name,</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">                   <span class="dt">set_won_team_2   =</span> set_won) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="st">            </span><span class="kw">filter</span>(match <span class="op">==</span><span class="st"> &quot;home&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="st">            </span><span class="kw">select</span>(<span class="op">-</span>match)</a>
<a class="sourceLine" id="cb1-25" data-line-number="25"></a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    <span class="co"># Select home team matches and join home team information</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    df_away &lt;-<span class="st">  </span>matches <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="st">                </span><span class="kw">rename</span>(<span class="dt">team_id_1   =</span> team_id,</a>
<a class="sourceLine" id="cb1-29" data-line-number="29">                       <span class="dt">team_name_1 =</span> team_name,</a>
<a class="sourceLine" id="cb1-30" data-line-number="30">                       <span class="dt">set_won_team_1   =</span> set_won) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="st">                </span><span class="kw">filter</span>(match <span class="op">==</span><span class="st"> &quot;away&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="st">                </span><span class="kw">select</span>(<span class="op">-</span>match) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(df_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">match =</span> <span class="st">&quot;away&quot;</span>)</a>
<a class="sourceLine" id="cb1-33" data-line-number="33"></a>
<a class="sourceLine" id="cb1-34" data-line-number="34">    <span class="co"># Bind datasets</span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35">    df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df_home, df_away)</a>
<a class="sourceLine" id="cb1-36" data-line-number="36"></a>
<a class="sourceLine" id="cb1-37" data-line-number="37">    <span class="kw">rm</span>(df_away, df_<span class="dv">1</span>, df_home)</a></code></pre></div>
<p>In the next step, we generate the variables match_points_team_1 and match_points_team_2. These variables are generated according to the offical VBL rules, i.e., a team is rewarded 3 points if it wins the match except in the case of a tie-break. In tie-breaks, the winning team is rewarded 2 points and the team which looses the match is rewarded 1 point. Note that we replace the match points with 0 in the play-off matches.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Teams get 0 points if they win at most one set, 3 points of they win 3 sets</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co"># and the opponent wins at most one set. In case of tie-breaks, points are splitted.</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># The winning team gets 2 points and the other team 1 point.</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">match_points_team_1 =</span> </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">             <span class="kw">case_when</span>(set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>, </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">                       set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">                       set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">                       set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">                       set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">                       set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">match_points_team_2 =</span> </a>
<a class="sourceLine" id="cb2-14" data-line-number="14">             <span class="kw">case_when</span>(set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>, </a>
<a class="sourceLine" id="cb2-15" data-line-number="15">                       set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">                       set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2-17" data-line-number="17">                       set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">                       set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">                       set_won_team_<span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>set_won_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">match_points_team_1 =</span> </a>
<a class="sourceLine" id="cb2-21" data-line-number="21">               <span class="kw">replace</span>(match_points_team_<span class="dv">1</span>, competition_stage <span class="op">!=</span><span class="st"> &quot;Main round&quot;</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">             <span class="dt">match_points_team_2 =</span> </a>
<a class="sourceLine" id="cb2-23" data-line-number="23">               <span class="kw">replace</span>(match_points_team_<span class="dv">2</span>, competition_stage <span class="op">!=</span><span class="st"> &quot;Main round&quot;</span>, <span class="dv">0</span>))</a></code></pre></div>
<p>It might be useful to measure the overall performance difference between teams. This can be done twofold. First, using the difference of points the team scored in previous matches. Second, sometimes a better measure might be the ratio or difference of won sets to lost sets. Both measures are computed by sorting the dataset by date, summing up the number of league points/sets won and substracting the corresponding value for each match to ensure that the measures are adjusted to the value before each match. Note that the league points in the play-off matches equal the number of points at the end of the main round. Finally,the difference between the league points, the quotient of the sets won by each team, and the set difference is computed.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Generate league_points (sum of match_points before match) and </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># league_sets (sum of sets won before match)</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">      </span><span class="kw">group_by</span>(league_gender, season_id, team_id_<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">      </span><span class="kw">arrange</span>(date_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">league_points_team_1 =</span> <span class="kw">cumsum</span>(match_points_team_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">             <span class="dt">league_points_team_1 =</span> league_points_team_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>match_points_team_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">league_sets_team_1 =</span> <span class="kw">cumsum</span>(set_won_team_<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">             <span class="dt">league_sets_team_1 =</span> league_sets_team_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>set_won_team_<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="st">      </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">      </span><span class="kw">group_by</span>(league_gender, season_id, team_id_<span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">      </span><span class="kw">arrange</span>(date_time) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">league_points_team_2 =</span> <span class="kw">cumsum</span>(match_points_team_<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">             <span class="dt">league_points_team_2 =</span> league_points_team_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>match_points_team_<span class="dv">2</span>)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">league_sets_team_2 =</span> <span class="kw">cumsum</span>(set_won_team_<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">             <span class="dt">league_sets_team_2 =</span> league_sets_team_<span class="dv">2</span> <span class="op">-</span><span class="st"> </span>set_won_team_<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">      </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">league_points_diff   =</span> league_points_team_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>league_points_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">             <span class="dt">league_sets_quotient =</span> league_sets_team_<span class="dv">1</span><span class="op">/</span>league_sets_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">             <span class="dt">league_sets_diff     =</span> league_sets_team_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>league_sets_team_<span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(set_won_team_<span class="dv">1</span>, set_won_team_<span class="dv">2</span>))</a></code></pre></div>
<p>For analyzing the probability to win a match it might be useful to measure the distance between the home sport facility of a team and the match location. To do so, we join the match adress to the dataset. Then we select the relevant information from the team_adresses dataset and join it twice to the dataset. Once for team 1 and once for team 2. Then we make use of the geosphere package to compute the distance between the home sport facility of each team and the sport facility where the match is played (distance_team_1 and distance_team_2). In this step we also join information on the capacity of of the sport facility, i.e., the maximum number of spectators for the home sport facility of team 1 and team 2 (max_spectators_team_1 and max_spectators_team_2).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Rename coordinates of the match location</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(match_adresses) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">lat_match =</span> lat,</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">                                                  <span class="dt">lon_match =</span> lon)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co"># Select relevant information from team_adresses</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">tmp &lt;-<span class="st"> </span>team_adresses <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(season_id, team_id, gym_adress, max_spectators, lon, lat)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># Join the dataset twice for team 1 and team 2</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">      </span><span class="kw">left_join</span>(tmp, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span> =<span class="st"> &quot;season_id&quot;</span>, <span class="st">&quot;team_id_1&quot;</span> =<span class="st"> &quot;team_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="st">      </span><span class="kw">rename</span>(<span class="dt">lon_team_1 =</span> lon,</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">             <span class="dt">lat_team_1 =</span> lat,</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">             <span class="dt">gym_adress_team_1 =</span> gym_adress,</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">             <span class="dt">max_spectators_team_1 =</span> max_spectators) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="st">      </span><span class="kw">left_join</span>(tmp, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span> =<span class="st"> &quot;season_id&quot;</span>, <span class="st">&quot;team_id_2&quot;</span> =<span class="st"> &quot;team_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="st">      </span><span class="kw">rename</span>(<span class="dt">lon_team_2 =</span> lon,</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">             <span class="dt">lat_team_2 =</span> lat,</a>
<a class="sourceLine" id="cb4-18" data-line-number="18">             <span class="dt">gym_adress_team_2 =</span> gym_adress,</a>
<a class="sourceLine" id="cb4-19" data-line-number="19">             <span class="dt">max_spectators_team_2 =</span> max_spectators)</a>
<a class="sourceLine" id="cb4-20" data-line-number="20"></a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="co"># Compute the distance of team 1's home gym to match gym</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">p1 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lon_team_<span class="dv">1</span>, lat_team_<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb4-23" data-line-number="23">p2 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lon_match, lat_match))</a>
<a class="sourceLine" id="cb4-24" data-line-number="24"></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="co"># Compute the distance in km to the dataset</span></a>
<a class="sourceLine" id="cb4-26" data-line-number="26">df<span class="op">$</span>distance_team_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">distMeeus</span>(p1, p2)<span class="op">/</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb4-27" data-line-number="27"></a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co"># Compute the distance of team 1's home gym to match gym</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">p1 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lon_team_<span class="dv">2</span>, lat_team_<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb4-30" data-line-number="30">p2 &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(lon_match, lat_match))</a>
<a class="sourceLine" id="cb4-31" data-line-number="31"></a>
<a class="sourceLine" id="cb4-32" data-line-number="32"><span class="co"># Compute the distance in km to the dataset</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33">df<span class="op">$</span>distance_team_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">distMeeus</span>(p1, p2)<span class="op">/</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb4-34" data-line-number="34"></a>
<a class="sourceLine" id="cb4-35" data-line-number="35"><span class="kw">rm</span>(p1, p2, tmp)</a></code></pre></div>
<p>Now we have to define the maximal number of spectators (gym_capacity) which can attend the match. To do so, we have to distinguish between home and away matches. For home matches, the variable max_spectators equals to the variable max_spectators_team_1. For away matches, the variable equals the variable max_spectators_team_2. In addition, if the adress of the match location does not equal to the gym adress of the home team, then the capacity of the gym is unknown. Then we have to change the value of the varable to NA.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">gym_capacity =</span> </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">               <span class="kw">case_when</span>(match <span class="op">==</span><span class="st"> &quot;home&quot;</span> <span class="op">&amp;</span><span class="st"> </span>(lon_match <span class="op">==</span><span class="st"> </span>lon_team_<span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>lat_match <span class="op">==</span><span class="st"> </span>lat_team_<span class="dv">1</span>) <span class="op">~</span><span class="st"> </span>max_spectators_team_<span class="dv">1</span>, </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                         match <span class="op">==</span><span class="st"> &quot;away&quot;</span> <span class="op">&amp;</span><span class="st"> </span>(lon_match <span class="op">==</span><span class="st"> </span>lon_team_<span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>lat_match <span class="op">==</span><span class="st"> </span>lat_team_<span class="dv">2</span>) <span class="op">~</span><span class="st"> </span>max_spectators_team_<span class="dv">2</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                       )) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;lon_&quot;</span>), <span class="op">-</span><span class="kw">starts_with</span>(<span class="st">&quot;lat&quot;</span>), <span class="op">-</span><span class="kw">c</span>(max_spectators_team_<span class="dv">1</span>, max_spectators_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">             adress, gym_adress_team_<span class="dv">1</span>, gym_adress_team_<span class="dv">2</span>))</a></code></pre></div>
<p>Next we have to compute the national diversity, roster size and mean height of teams. Herefore, we join the players dataset to the matchstats dataset and compute several diversity measures for each match. We do this to ensure that we measure the diversity of these dimensions among the fielded players. National diversity is computed using the diverse package as the Blau index of diversity and the Herfindahl-Herschman-Index. Roster size is computed from the players dataset and equals the number of players which was on the roster of the team. Finally, the mean height of the fielded players is computed. In the last step, we generate a winning dummy.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Join nationality information to matchstats</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">lineups &lt;-<span class="st"> </span>matchstats <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">           </span><span class="kw">select</span>(league_gender<span class="op">:</span>player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">           </span><span class="kw">left_join</span>(players, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;league_gender&quot;</span>, <span class="st">&quot;season_id&quot;</span>, <span class="st">&quot;team_id&quot;</span>, <span class="st">&quot;player_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">           </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(team_name, lastname, firstname, gender, shirt_number, player_id))</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co"># Prepare dataset to compute diversity measures using diverse package</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">nat_diversity &lt;-<span class="st"> </span>lineups <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">                 </span><span class="kw">group_by</span>(season_id, match_id, team_id, nationality) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">                 </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="st">                 </span><span class="kw">unite</span>(season_id, match_id, team_id, <span class="dt">col =</span> <span class="st">&quot;id&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">                 </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">factor</span>(id)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">                 </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co"># Compute diversity measures, separate ids and select relevant measures</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16">nat_diversity &lt;-<span class="st"> </span><span class="kw">diversity</span>(<span class="kw">as.data.frame</span>(nat_diversity)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-17" data-line-number="17"><span class="st">                 </span><span class="kw">rownames_to_column</span>(<span class="dt">var =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="st">                 </span><span class="kw">separate</span>(id, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span>, <span class="st">&quot;match_id&quot;</span>, <span class="st">&quot;team_id&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">                 </span><span class="kw">select</span>(season_id<span class="op">:</span>team_id, HHI, blau.index) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">                 </span><span class="kw">rename</span>(<span class="dt">herfindahl_herschman_index =</span> HHI,</a>
<a class="sourceLine" id="cb6-21" data-line-number="21">                        <span class="dt">blau_index =</span> blau.index)</a>
<a class="sourceLine" id="cb6-22" data-line-number="22"></a>
<a class="sourceLine" id="cb6-23" data-line-number="23"><span class="co"># Roster size</span></a>
<a class="sourceLine" id="cb6-24" data-line-number="24">roster &lt;-<span class="st"> </span>players <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-25" data-line-number="25"><span class="st">          </span><span class="kw">group_by</span>(season_id, team_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-26" data-line-number="26"><span class="st">          </span><span class="kw">summarise</span>(<span class="dt">roster_size_team_1 =</span> <span class="kw">n</span>())  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-27" data-line-number="27"><span class="st">          </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb6-28" data-line-number="28"></a>
<a class="sourceLine" id="cb6-29" data-line-number="29"><span class="co"># Mean height</span></a>
<a class="sourceLine" id="cb6-30" data-line-number="30">height &lt;-<span class="st"> </span>matchstats <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-31" data-line-number="31"><span class="st">          </span><span class="kw">select</span>(league_gender<span class="op">:</span>player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-32" data-line-number="32"><span class="st">          </span><span class="kw">left_join</span>(players, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;league_gender&quot;</span>, <span class="st">&quot;season_id&quot;</span>, <span class="st">&quot;team_id&quot;</span>, <span class="st">&quot;player_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-33" data-line-number="33"><span class="st">          </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(team_name, lastname, firstname, gender, shirt_number, player_id)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-34" data-line-number="34"><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">replace</span>(height, height <span class="op">==</span><span class="st"> </span><span class="dv">78</span>, <span class="dv">178</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-35" data-line-number="35"><span class="st">          </span><span class="kw">group_by</span>(season_id, match_id, team_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-36" data-line-number="36"><span class="st">          </span><span class="kw">summarise</span>(<span class="dt">mean_height =</span> <span class="kw">mean</span>(height, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-37" data-line-number="37"><span class="st">          </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb6-38" data-line-number="38"></a>
<a class="sourceLine" id="cb6-39" data-line-number="39"><span class="co"># Join to final dataset</span></a>
<a class="sourceLine" id="cb6-40" data-line-number="40">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(nat_diversity, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span> =<span class="st"> &quot;season_id&quot;</span>, </a>
<a class="sourceLine" id="cb6-41" data-line-number="41">                                       <span class="st">&quot;match_id&quot;</span> =<span class="st"> &quot;match_id&quot;</span>, </a>
<a class="sourceLine" id="cb6-42" data-line-number="42">                                       <span class="st">&quot;team_id_1&quot;</span> =<span class="st"> &quot;team_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-43" data-line-number="43"><span class="st">             </span><span class="kw">left_join</span>(roster, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span> =<span class="st"> &quot;season_id&quot;</span>, </a>
<a class="sourceLine" id="cb6-44" data-line-number="44">                                       <span class="st">&quot;team_id_1&quot;</span> =<span class="st"> &quot;team_id&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-45" data-line-number="45"><span class="st">             </span><span class="kw">left_join</span>(height, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;season_id&quot;</span> =<span class="st"> &quot;season_id&quot;</span>, </a>
<a class="sourceLine" id="cb6-46" data-line-number="46">                                       <span class="st">&quot;match_id&quot;</span> =<span class="st"> &quot;match_id&quot;</span>, </a>
<a class="sourceLine" id="cb6-47" data-line-number="47">                                       <span class="st">&quot;team_id_1&quot;</span> =<span class="st"> &quot;team_id&quot;</span>))</a>
<a class="sourceLine" id="cb6-48" data-line-number="48"></a>
<a class="sourceLine" id="cb6-49" data-line-number="49"><span class="co"># Generate winning variable</span></a>
<a class="sourceLine" id="cb6-50" data-line-number="50">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">win =</span> <span class="kw">case_when</span>(match_points_team_<span class="dv">1</span> <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-51" data-line-number="51">                                    match_points_team_<span class="dv">1</span> <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb6-52" data-line-number="52"></a>
<a class="sourceLine" id="cb6-53" data-line-number="53"><span class="kw">rm</span>(nat_diversity, roster, height, lineups)</a></code></pre></div>
<p>Finally, we select all relevant variables for the analysis and create additional factor variables for time and day of the match.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">weekday =</span> <span class="kw">factor</span>(<span class="kw">weekdays</span>(date_time)),</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">             <span class="dt">date    =</span> <span class="kw">format</span>(date_time, <span class="st">'%d-%m-%Y'</span>),</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">             <span class="dt">time    =</span> <span class="kw">strftime</span>(date_time, <span class="dt">format=</span><span class="st">&quot;%H:%M:%S&quot;</span>),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">             <span class="dt">match   =</span> <span class="kw">factor</span>(match),</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">             <span class="dt">league_gender =</span> <span class="kw">factor</span>(league_gender),</a>
<a class="sourceLine" id="cb7-7" data-line-number="7">             <span class="dt">competition_stage =</span> <span class="kw">factor</span>(competition_stage)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">      </span><span class="kw">select</span>(league_gender<span class="op">:</span>match_id, match_duration, gym,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">             spectators, gym_capacity, date, time, weekday, match, win,</a>
<a class="sourceLine" id="cb7-10" data-line-number="10">             team_name_<span class="dv">1</span>, team_name_<span class="dv">2</span>, team_id_<span class="dv">1</span>, team_id_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb7-11" data-line-number="11">             match_points_team_<span class="dv">1</span>, match_points_team_<span class="dv">2</span>, </a>
<a class="sourceLine" id="cb7-12" data-line-number="12">             league_points_team_<span class="dv">1</span>, league_points_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb7-13" data-line-number="13">             league_sets_team_<span class="dv">1</span>, league_sets_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">             distance_team_<span class="dv">1</span>, distance_team_<span class="dv">2</span>,</a>
<a class="sourceLine" id="cb7-15" data-line-number="15">             roster_size_team_<span class="dv">1</span>, blau_index, </a>
<a class="sourceLine" id="cb7-16" data-line-number="16">             herfindahl_herschman_index, mean_height)</a></code></pre></div>
<p>Now we can split the dataset into a dataset for the analysis of the winning probability depending on varios team characteristics and a dataset for the analysis of the determinants of the number of spectators.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">df_<span class="dv">1</span> &lt;-<span class="st"> </span>df</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">df_<span class="dv">2</span> &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">        </span><span class="kw">filter</span>(match <span class="op">==</span><span class="st"> &quot;home&quot;</span>)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5"></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># write.dta(df, &quot;df_1.dta&quot;)</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co"># write.dta(df, &quot;df_2.dta&quot;)</span></a></code></pre></div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
